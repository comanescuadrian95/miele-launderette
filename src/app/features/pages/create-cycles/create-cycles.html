<section class="content-wrapper" aria-labelledby="create-cycle-heading">
  <h2 id="create-cycle-heading">Start a new laundry cycle</h2>

  <mat-stepper orientation="vertical" [linear]="isLinear" #stepper>
    <mat-step [stepControl]="userForm" label="User Identification">
      <form [formGroup]="userForm">
        <div class="step-zone">
          <mat-form-field appearance="outline">
            <mat-label>User ID</mat-label>
            <input
              matInput
              placeholder="e.g. user123"
              formControlName="userId"
              [matAutocomplete]="auto"
              aria-describedby="userIdHelp"
              cdkFocusInitial
            />
            <mat-autocomplete #auto="matAutocomplete">
              @for (user of users(); track user) {
              <mat-option [value]="user">{{ user }}</mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
          <div class="actions">
            <button matButton="filled" matStepperNext>Next</button>
          </div>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="deviceForm" label="Select Device & Cycle">
      <form [formGroup]="deviceForm">
        <div class="step-zone">
          <div class="cycles" role="radiogroup" aria-label="Available devices">
            @for (device of devices(); track device.id) {
            <app-card-device
              class="device-card"
              [device]="device"
              [selectedInput]="device.id === deviceForm.value.selectedDevice?.id"
              (selectedChange)="onDeviceSelected(device)"
              [attr.aria-checked]="device.id === deviceForm.value.selectedDevice?.id"
              role="radio"
            ></app-card-device>
            } @if (!devices() || devices().length === 0) {
            <div class="empty-state" aria-live="polite">
              No devices available right now. Please try again shortly.
            </div>
            }
          </div>
          <div class="actions">
            <button matButton="outlined" color="primary" matStepperPrevious>Back</button>
            <button matButton="filled" matStepperNext [disabled]="deviceForm.invalid">Next</button>
          </div>
        </div>
      </form>
    </mat-step>

    <mat-step label="Confirm Cycle">
      <div class="step-zone">
        <p class="confirm-text">
          You are about to start a new cycle for
          <strong>{{ deviceForm.value.selectedDevice?.name || '—' }}</strong>
          as <strong>{{ userForm.value.userId || 'unknown' }}</strong
          >.
        </p>
        <div class="summary">
          <div class="summary-item">
            <span class="label">User</span>
            <span class="value">{{ userForm.value.userId || 'unknown' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Device</span>
            <span class="value">{{ deviceForm.value.selectedDevice?.name || '—' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Type</span>
            <span class="value">{{ deviceForm.value.selectedDevice?.type || '—' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Price</span>
            <span class="value">
              {{ deviceForm.value.selectedDevice?.price || '—' }}
              {{ deviceForm.value.selectedDevice?.currency || '' }}
            </span>
          </div>
          <div class="summary-item">
            <span class="label">Device ID</span>
            <span class="value">{{ deviceForm.value.selectedDevice?.id || '—' }}</span>
          </div>
        </div>
        <div class="actions">
          <button matButton="outlined" matStepperPrevious>Back</button>
          <button matButton="filled" (click)="submitStepperForm()" [disabled]="deviceForm.invalid">
            Create
          </button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</section>
